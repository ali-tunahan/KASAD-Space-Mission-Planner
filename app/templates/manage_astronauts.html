{% extends "master.html" %} {% block content%}
<style>
  .pop-edit {
    position: fixed;
    width: 40vw;
    height: 74vh;
    padding: 10px;
    background-color: #33333f;
    top: 50%;
    left: 50%;
    margin-top: -37vh; /* Negative half of height. */
    margin-left: -20vw; /* Negative half of width. */
    z-index: 10;
  }
</style>
<div class="container-fluid py-4 px-5">
  <h1 class="display-6 pb-2">Manage Astronauts</h1>
  <div class="accordion" id="accordionExample">
    {% for astronaut in astronauts %}
    <div class="accordion-item border border-secondary">
      <h2 class="accordion-header">
        <button
          class="accordion-button"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#collapse{{ loop.index }}"
          aria-expanded="false"
          aria-controls="collapse{{ loop.index }}"
        >
          <p class="h4">{{ astronaut.title + ' ' + astronaut.first_name +  ' ' + astronaut.middle_name + ' ' + astronaut.last_name }}</p>
        </button>
      </h2>
      <div
        id="collapse{{ loop.index }}"
        class="accordion-collapse collapse collapse-horizontal"
        data-bs-parent="#accordionExample"
        style="transition: 0.5s"
      >
        <div class="accordion-body" style="width: 1000px">
          <div class="container-fluid d-flex flex-column px-3">
            <div style="width: 50%">
              <ul class="list-group list-group-flush m-2">
                <li class="list-group-item">
                  <strong>Age: </strong> 15234512341234
                </li>
                <li class="list-group-item">
                  <strong>Performance: </strong> gqrgrgqrgqrg
                </li>
                <li class="list-group-item">
                  <strong>Years Worked: </strong> 412341234
                </li>
              </ul>
            </div>
            <div class="pt-4">
              <p class="d-inline-flex gap-1">
                <button
                  class="btn btn-primary"
                  type="button"
                  data-bs-toggle="modal"
                  data-bs-target="#staticModal{{ loop.index }}"
                  onclick="fetchAstronautData('{{ astronaut.astronaut_id }}', '{{ loop.index }}')"
                >
                  Button with data-bs-target
                </button>
              </p>
              <div
                class="modal fade border border-5 border-info border-top-0 border-bottom-0 border-opacity-25"
                id="staticModal{{ loop.index }}"
                data-bs-backdrop="static"
                data-bs-keyboard="false"
                tabindex="-1"
                aria-labelledby="staticBackdropLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog modal-dialog-scrollable modal-xl">
                  <div
                    class="modal-content border-secondary border-2 card-body m-4"
                  >
                    <div class="modal-header">
                      <p class="lead">
                        Please change the necessary information that you want to
                        edit.
                      </p>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                      ></button>
                    </div>
                    <form class="modal-body m-4">
                      <div class="row mb-2">
                        <div class="col">
                          <div class="ps-1">First Name</div>
                        </div>
                        <div class="col">
                          <div class="ps-1">Middle Name</div>
                        </div>
                        <div class="col">
                          <div class="ps-1">Last Name</div>
                        </div>
                      </div>
                      <div class="row mb-4">
                        <div class="col">
                          <input
                            name="fname"
                            id="fname"
                            type="text"
                            class="form-control"
                            value="my-first-name"
                          />
                        </div>
                        <div class="col">
                          <input
                            name="mname"
                            id="mname"
                            type="text"
                            class="form-control"
                            value="my-middle-name"
                          />
                        </div>
                        <div class="col">
                          <input
                            name="lname"
                            id="lname"
                            type="text"
                            class="form-control"
                            value="my-last-name"
                          />
                        </div>
                      </div>
                      <div class="text-center">Birth Date</div>
                      <div class="row mb-2">
                        <div class="col">
                          <div class="ps-1">Day</div>
                        </div>
                        <div class="col">
                          <div class="ps-1">Month</div>
                        </div>
                        <div class="col">
                          <div class="ps-1">Year</div>
                        </div>
                      </div>
                      <div class="row mb-3">
                        <div class="col">
                          <input
                            name="day"
                            type="text"
                            class="form-control"
                            value="day"
                          />
                        </div>
                        <div class="col">
                          <input
                            name="month"
                            type="text"
                            class="form-control"
                            value="month"
                          />
                        </div>
                        <div class="col">
                          <input
                            name="year"
                            type="text"
                            class="form-control"
                            value="year"
                          />
                        </div>
                      </div>
                      <div class="row mb-1">
                        <div class="col">
                          <div class="ps-1">Nationality</div>
                        </div>
                      </div>
                      <div class="row mb-3">
                        <div class="col">
                          <input
                            name="nationality"
                            id="nationality"
                            type="text"
                            class="form-control"
                            value="nationality"
                          />
                        </div>
                      </div>
                      <div class="row mb-1">
                        <div class="col">
                          <div class="ps-1">Rank</div>
                        </div>
                      </div>
                      <div class="row mb-3">
                        <div class="col">
                          <input
                            name="rank"
                            id="rank"
                            type="text"
                            class="form-control"
                            value="rank"
                          />
                        </div>
                      </div>
                      <div class="row mb-1">
                        <div class="col">
                          <div class="ps-1">Title</div>
                        </div>
                      </div>
                      <div class="row mb-3">
                        <div class="col">
                          <input
                            name="title"
                            id="title"
                            type="text"
                            class="form-control"
                            value="title"
                          />
                        </div>
                      </div>
                      <div class="row mb-1">
                        <div class="col">
                          <div class="ps-1">Exp</div>
                        </div>
                      </div>
                      <div class="row mb-3">
                        <div class="col">
                          <input
                            name="exp"
                            id="exp"
                            type="text"
                            class="form-control"
                            value="exp"
                          />
                        </div>
                      </div>
                      <div class="row w-50 mx-auto">
                        <button type="submit" class="btn btn-secondary">
                          Submit
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<script>
  function fetchAstronautData(astronautId, loopIndex) {
    console.log(astronautId);
    console.log(loopIndex)
    //console.log(loopIndex);
    fetch('/manage_astronauts?astronaut_id=' + encodeURIComponent(astronautId), {
      method: 'GET',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
    })
    .then(response => response.json())
    .then(data => {
      if (data.error) {
        alert(data.error);
      } else {
        console.log(data); // Output data to console for debugging
        // Get the modal specific to this astronaut
        var modal = document.getElementById('staticModal' + loopIndex);
        // Use the modal context to find each input
        document.getElementById('fname').value = data.first_name;
        modal.querySelector('[name="fname"]').value = data.first_name || '';
        modal.querySelector('[name="mname"]').value = data.middle_name || '';
        modal.querySelector('[name="lname"]').value = data.last_name || '';
        modal.querySelector('[name="nationality"]').value = data.nationality || '';
        modal.querySelector('[name="rank"]').value = data.rank || '';
        modal.querySelector('[name="title"]').value = data.title || '';
        modal.querySelector('[name="exp"]').value = data.years_of_experience || '';
        // Continue setting other fields as needed
      }
    })
    //.catch(error => console.error('Error:', error));
  }
  </script>

{% endblock %}
